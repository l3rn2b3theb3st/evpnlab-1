feature fabric forwarding
feature interface-vlan
!
fabric forwarding anycast-gateway-mac 0000.abcd.1025
!
!
vlan 501
  vn-segment 50001
  name TENANT_A_BRvLan
vlan 502
  vn-segment 50002
  name TENANT_B_BRvLan

!# ===========================
!# L3VNI & VRF Configuration
!# ===========================
vrf context TENANT_A
  vni 50001
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
!
vrf context TENANT_B
  vni 50002
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
!

!
!# ===========================
!# L3 VLAN Interfaces
!# ===========================
!
interface Vlan501
  no shutdown
  description L3-VNI TENANT_A
  vrf member TENANT_A
  ip forward
!
interface Vlan502
  no shutdown
  description L3-VNI TENANT_B
  vrf member TENANT_B
  ip forward
!

!# ===========================
!# Tenant VLAN Interfaces (Local)
!# ===========================
interface Vlan10
  no shutdown
  vrf member TENANT_A
  ip address 192.168.10.254/24 tag 50001
  ip pim sparse-mode
  fabric forwarding mode anycast-gateway
!
interface Vlan20
  no shutdown
  vrf member TENANT_A
  ip address 192.168.20.254/24 tag 50001
  ip pim sparse-mode
  fabric forwarding mode anycast-gateway
!

!# ===========================
!# NVE Interface Configuration
!# ===========================
interface nve1
  no shutdown
  host-reachability protocol bgp
  source-interface loopback0
!
  member vni 50001 associate-vrf
  member vni 50002 associate-vrf
!
!# ===========================
!# Route-Map Configuration
!# ===========================
route-map RM-DIRECT-A permit 10
  match tag 50001
!
route-map RM-DIRECT-B permit 10
  match tag 50002
!

!# ===========================
!# BGP VRF Configuration
!# ===========================
router bgp 65100
  vrf TENANT_A
    address-family ipv4 unicast
      redistribute direct route-map RM-DIRECT-A
  vrf TENANT_B
    address-family ipv4 unicast
      redistribute direct route-map RM-DIRECT-B
